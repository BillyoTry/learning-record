第零章实战，只是简单的复习基础内容。

### 读书笔记

1. 软件是如何访问硬件的：硬件在输入输出上大体分为串行和并行，相应的接口也就是串行接口和并行接口，CPU通过串行接口于串行设备数据传输。访问外部硬件有两个方式：

   - 将某个外设的内存映射到一定范围的地址空间中，CPU通过地址总线访问该内存区域时会落到外设的内存中，这种映射让CPU访问外设的内存就如同访问主板上的物理内存一样。比如显卡，显卡是显示器的适配器，CPU不直接和显示器交互，它只和显卡通信。显卡上有片内存叫显存，它被映射到主机物理内存上低端1MB的0xB8000~0xBFFFF。CPU访问这片内存就是访问显存，往这片内存上写字便是往屏幕上打印内容。
   - 外设通过IO接口与CPU通信，CPU访问外设，就是访问IO接口，由IO接口将信息传递给另一端的外设，也就是说，CPU从来不知道有这些设备的存在，它只知道自己操作的IO接口。访问IO接口的本质就是访问接口上的寄存器，这些寄存器就是人们常说的端口。

2. 内存访问为什么要分段：

   - 让CPU采用"段基址+段内偏移地址"的方式来访问任意内存，这样的好处是程序可以重定位。
   - 加载用户程序时，只要将整个段的内容复制到新的位置，再将段基址寄存器中的地址改成该地址，程序便可准确无误地运行，因为程序中用的是段内偏移地址，相对于新的段基址，该偏移地址处的内存内容还是一样的。
   - 早期寄存器只有16位，通过将段基址左移4位（乘以16），在和16位段内偏移地址相加，达到20位的效果。

3. 代码中的代码段、数据段和内存的分段机制：

   - 编译器负责挑选出数据具备的属性，从而根据属性将程序片段分类，比如，划分出了只读属性的代码段和可写属性的数据的。编译器并没有让段具备某种属性，对于代码段，编译器所做的只是将代码归类到一起而已，也就是将程序中的有关代码的多个section合并成一个大的segment(这就是我们说的代码段)，它并没有为代码段添加额外的信息。

   - 操作系统通过设置GDT(全局描述表，表中每一项称为段描述符)来构建段描述符，在段描述符中指定段的位置、大小及属性(包括S字段和TYPE字段)。也就是说，操作系统认为代码应该是只读的，所以给用来指向代码段的那个段描述符设置了只读的属性，这才是真正给段添加属性的地方。

   - CPU中的段寄存器提前被操作系统赋予相应选择子，从而确定指向的段。在执行指令时，会根据该段的属性来判断指令的行为，若有返回则发出异常。

     总的来说就是操作系统给GDT中的段描述符设置属性，编译器负责给段划分，。如果 GDT 中的代码段描述符具备可写的属性，那编译器再怎么划分代码段都没有用，有判断权利的只有 CPU。

4. 物理地址、逻辑地址、有效地址、线性地址、虚拟地址的区别 ：

   - 物理地址就是物理内存真正的地址，在实模式下，"段基址+段内偏移地址"经过段部件的处理，直接输出的就是物理地址，CPU可以直接用这个地址访问内存。
   - 在保护模式下，"段基址+段内偏移地址"称为线性地址，不过，此时的段基址不再是真正的地址，而是选择子。它本质是个索引，类似于数组下标，通过这个索引便能在GDT中找到相应的段描述符，在该描述符中记录该段的起始、大小等信息，这样便得到了段基址。如果没有开启分页机制，也就得到了物理地址。
   - 在分页机制下，虚拟地址和线性地址都是一回事，可以理解为线性地址的别名，虚拟地址通过页部件转换成了具体的物理地址。
   - 无论在实模式或是保护模式下，段内偏移地址又称为有效地址，也称为逻辑地址。

   ![image-20200810092109135.png](https://i.loli.net/2020/08/12/BEHeyJkpa7XzOt8.png)

5. BIOS中断、DOS中断、Linux中断的区别：

   - BIOS和DOS都是存在与实模式下的程序，由它们建立的中断调用都是建立在中断向量表中的。它们都是通过软中断指令int中断号来调用的。
   - BIOS的中断调用的主要功能是提供了硬件访问的方法。
   - Linux的系统调用和DOS中断调用类似，不过Linux是通过int 0x80指令进入一个中断程序后再根据eax寄存器的值来调用不同的子功能函数。
   - 如果是实模式下执行int 指令，会自动去访问中断向量表。如果在保护模式下执行int 指令，则会自动访问中断描述符表。

6. 操作系统是如何识别文件系统的：

   - 各分区都有超级块，一般位于本分区的第二个扇区，比如若各分区的扇区以0开始索引，其第1个扇区便是超级块。超级块里面记录了此分区的信息，其中就有文件系统的魔数，一种文件系统对应一个魔数，比对此值便知道文件系统类型了。

7. MBR、EBR、DBR和OBR各是什么

   - 计算机在接电之后运行的是基本输入输出系统BIOS，BIOS只完成一些简单的检测或初始化工作，然后将处理器使用权交给MBR，MBR位于整个硬盘最开始的扇区，然后MBR交给内核加载器OBR(位于各分区起始的扇区)，DBR也称为OBR，EBR 是扩展分区中为了兼容 MBR 才提出的概念，主要是兼容 MBR 中的分区表。

   

   


